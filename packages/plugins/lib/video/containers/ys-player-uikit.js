/**
 * Created by PengLing on 2019/09/26. 
 * 
 * 萤石视频直播（基于萤石云 UIKit Javascript） 
 * 官方参考：https://open.ys7.com/doc/zh/uikit/uikit_javascript.html
 */
'use strict';

import React from 'react';
import PropTypes from 'prop-types';
// import Cookie from 'js-cookie';

class YSUIKitPlayer extends React.Component {
    constructor(props) {
        super(props);
        this.player = null;
    }

    static propTypes = {
        url: PropTypes.string.isRequired
    };

    loadScript = () => {
        var script = document.createElement('script')
        script.setAttribute('type', 'text/javascript')
        script.setAttribute('src', '/assets/player/ezuikit_v2.6/ezuikit.js')
        script.onerror = () => { console.log('ezuikit script load error.') }
        script.onload = script.onreadystatechange = _ => this.initPlayer()
        document.body.appendChild(script)
    }

    initPlayer = () => {
        const { containerId, url, height, width, autoplay, token } = this.props;
        // let at = Cookie.get('ysAccessToken');
        if (!url || !token) return null;
        this.player = new EZUIKit.EZUIPlayer({ // init and play
            id: containerId || 'myEZUIPlayer',
            autoplay: autoplay || true,
            url: url, // 'ezopen://open.ys7.com/D36436063/1.live'
            accessToken: token,
            decoderPath: '/assets/player/ezuikit_v2.6',
            width: width || 400, // https://open.ys7.com/doc/zh/book/index/live_proto.html 单个播放器的长宽比例限制最小为{width: 400px;height: 300px;}
            height: height || 300,
            handleError: function (e) { console.log('ys player error:', e) }
        });
    }

    stopPlayer = () => {
        if (this.player) this.player.stop();
    }

    componentDidMount() {
        if (!window.EZUIKit) {
            this.loadScript();
        } else {
            this.initPlayer();
        }
    }

    componentWillUnmount() {
        this.stopPlayer(); // Destroy resources related to EZUIKit.EZUIPlayer when Component unmounted.
    }

    render() {
        return (
            // The outer <div> used to distroy <div id='loading-id-0'> generated by ezuikit.js when Component unmounted.
            <div>
                <div id={this.props.containerId || 'myEZUIPlayer'}></div>
            </div>
        )
    }
}

export default YSUIKitPlayer;
